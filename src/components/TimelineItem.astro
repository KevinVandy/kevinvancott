---
interface Project {
  name: string;
  link: string;
  description: string;
  techStack: string[];
  accomplishments: string[];
}

interface Props {
  dateRange: string;
  company: string;
  link: string;
  logo: string;
  logoHeight: number;
  logoWidth: number;
  title: string;
  projects: Project[];
}

const { dateRange, company, link, logo, logoHeight, logoWidth, title, projects } = Astro.props;

function lookupLogo(tech: string): string {
  const logoMap: { [key: string]: string } = {
    HTML: '/logos/html.png',
    CSS: '/logos/css.png',
    JavaScript: '/logos/javascript.png',
    TypeScript: '/logos/typescript.png',
    React: '/logos/react.png',
    Svelte: '/logos/svelte.png',
    Java: '/logos/java.png',
    Groovy: '/logos/groovy.png',
    'C#': '/logos/csharp.png',
    'C#.NET': '/logos/csharp.png',
    Grails: '/logos/grails.png',
    Nx: '/logos/nx.png',
    Elasticsearch: '/logos/elasticsearch.png',
    Storybook: '/logos/storybook.png',
    Cypress: '/logos/cypress.jpg',
    MySQL: '/logos/mysql.png',
    NodeJS: '/logos/nodejs.png',
    jQuery: '/logos/jquery.png',
    Python: '/logos/python.png',
    'Material UI': '/logos/mui.png',
    PHP: '/logos/php.png',
    Bootstrap: '/logos/bootstrap.png',
    SMUI: '/logos/smui.png',
    GraphQL: '/logos/graphql.png',
    AWS: '/logos/aws.png',
    'Next.js': '/logos/nextjs.png',
    SASS: '/logos/sass.png',
  };

  return logoMap[tech] || '';
}
---

<div class="group relative py-6 pl-8 sm:pl-32">
  <div class="flex justify-between items-start mb-1">
    <!-- Company and Title -->
    <div class="font-caveat text-2xl font-medium text-indigo-500 sm:mb-0">
      <a href={link} target="_blank" rel="noopener noreferrer">{company}</a> - {title}
    </div>
    <!-- Logo -->
    {logo && (
      <img 
        src={logo} 
        alt={`${company} logo`} 
        height={logoHeight} 
        width={logoWidth} 
        class="ml-4"
      />
    )}
  </div>
  <!-- Date Range and Projects -->
  <div
    class="mb-1 flex flex-col items-start before:absolute before:left-2 before:h-full before:-translate-x-1/2 before:translate-y-3 before:self-start before:bg-slate-300 before:px-px after:absolute after:left-2 after:box-content after:h-2 after:w-2 after:-translate-x-1/2 after:translate-y-1.5 after:rounded-full after:border-4 after:border-slate-50 after:bg-indigo-600 group-last:before:hidden sm:flex-row sm:before:left-0 sm:before:ml-[6.5rem] sm:after:left-0 sm:after:ml-[6.5rem]"
  >
    <time
      class="left-0 mb-3 inline-flex h-auto min-h-[1.5rem] w-auto px-2 py-1 translate-y-0.5 items-center justify-center rounded-full bg-emerald-100 text-xs font-semibold uppercase text-emerald-600 sm:absolute sm:mb-0 sm:w-[6rem] sm:text-center"
    >{dateRange}</time>
    <div class="text-xl mt-2 sm:mt-0 sm:ml-[2rem]">
      {projects.map((project) => (
        <div class="mb-4">
          <h3 class="text-lg font-semibold">
            <a href={project.link} target="_blank" rel="noopener noreferrer">{project.name}</a>
          </h3>
          <p class="text-sm">{project.description}</p>
          <div class="mt-2">
            <strong class="text-sm">Tech Stack:</strong>
            <div class="flex flex-wrap gap-2 mt-1">
              {project.techStack.map((tech) => {
                const logoSrc = lookupLogo(tech);
                return logoSrc ? (
                  <img
                    src={logoSrc}
                    alt={`${tech} logo`}
                    title={tech}
                    class="h-6 w-6 object-contain"
                  />
                ) : (
                  <span class="text-sm bg-gray-200 dark:bg-gray-700 rounded px-2 py-1">{tech}</span>
                );
              })}
            </div>
          </div>
          {project.accomplishments.length > 0 && (
            <div class="mt-2">
              <strong class="text-sm">Key Accomplishments:</strong>
              <ul class="list-disc list-inside text-sm">
                {project.accomplishments.map((accomplishment) => (
                  <li>{accomplishment}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      ))}
    </div>
  </div>
</div>
